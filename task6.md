Развёртывание приложения на сервере

До этого мы разрабатывали React-приложение локально, теперь пришло время выложить его на сервер и поделиться им со всем миром.

Процесс выгрузки React-приложения на сервер — deploy — мало чем отличается от обычного сайта. Но есть две тонкости:

На сервер нужно выкладывать не исходный код из директории src, а собранный проект. Например, в проектах, созданных через CRA, после запуска 'npm run build' будет сгенерирована директория build. Именно её содержимое и нужно размещать на сервере.
По умолчанию серверы обычно настроены под многостраничные сайты. Они ищут запрошенные пользователями ресурсы в файловой системе и когда не могут их там найти, отдают «Страницу 404». Но мы делаем SPA, поэтому нужно перенастроить сервер так, чтобы на любой запрос он отдавал страницу index.html, за исключением запросов медиаресурсов: картинок, шрифтов и др.

Перенос на сервер на Netlify
Для демонстрации готового проекта коллегам и заказчикам вместо классического хостинга удобнее использовать облачные сервисы.

Netlify — это облачный сервис, помогающий разработчикам публиковать свои сайты. Одно из основных его преимуществ — это возможность публиковать проекты прямо из GitHub или CodeSandbox.

Netlify, исходя из исходников проекта, сам умеет запускать сборку и перемещать собранные файлы на сервер, поэтому при использовании CRA нам не нужно об этом задумываться. По умолчанию серверы Netlify предполагают, что сайт будет многостраничный, и станут отдавать index.html только на запрос главной страницы, а при запросе любых других URL будет отдана «Страница 404», поскольку никаких других документов, кроме index.html, на сервере не окажется.

Но у нас SPA, так что нам нужно, чтобы на любой запрос сайта сервер отдавал ресурс index.html, а мы бы уже сами, на стороне клиента и исходя из роутинга решали, какую страницу нужно отобразить.

Чтобы изменить роутинг сервера, в директорию public в проекте нужно добавить файл \_redirects без указания расширения. Внутри этого файла можно указывать правила, сообщающие, какие файлы в ответ на какие запросы отдавать — правила серверного роутинга. Нам нужно, чтобы в ответ любой запрошенной страницы был отдан index.html, поэтому в файле укажем: /\* /index.html 200 .

Чтобы выложить проект на серверы Netlify, воспользуемся интерфейсом CodeSanbox и нажмём кнопку с иконкой ракеты:

Откроется окно с выбором сервиса для переноса на сервер:

Выберем Deploy to Netlify. В результате откроется окно с отображением процесса загрузки:

Дождитесь надписи: Sent zip to Netlify. We are done и откройте сайт, нажав на кнопку Open Netlify Site.

В результате будет открыт сайт.
